<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>1 Link per Day Dispenser</title>
<style>
  body {
    background:#0b0f12; color:#e6eef6; font-family:system-ui;
    display:flex; justify-content:center; align-items:center;
    height:100vh; margin:0;
  }
  .box {
    background:#101820; padding:26px; border-radius:14px;
    box-shadow:0 0 24px rgba(0,0,0,.5); width:90%; max-width:480px;
    text-align:center;
  }
  button {
    background:#1f6bff; color:white; border:none;
    padding:10px 18px; border-radius:8px; cursor:pointer;
    font-size:1rem; margin-top:10px;
  }
  button:disabled { opacity:.4; cursor:not-allowed; }
  .pill {
    background:#071827; padding:6px 12px;
    border-radius:999px; display:inline-block; margin-top:12px;
  }
  .link { margin-top:12px; word-break:break-all; }
</style>
</head>
<body>
  <div class="box">
    <h2>üéÅ Daily Link Dispenser</h2>
    <p>Claim <b>one random link per day</b> from the secret list.</p>
    <button id="dispenseBtn">Get Today‚Äôs Link</button>
    <div class="pill" id="status">Available today</div>
    <div class="link" id="linkOutput"></div>
  </div>

<script>
(async function(){
  const STORAGE_KEY = 'link-dispenser-v3';
  const btn = document.getElementById('dispenseBtn');
  const statusEl = document.getElementById('status');
  const out = document.getElementById('linkOutput');

  function today(){
    const d = new Date();
    return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
  }

  // load from /assets/links.json
  let allLinks = [];
  try {
    const res = await fetch('/assets/links.json', {cache:'no-store'});
    const data = await res.json();
    allLinks = Array.isArray(data) ? data : data.links || [];
  } catch(e) {
    out.textContent = '‚ö†Ô∏è Could not load /assets/links.json';
    btn.disabled = true;
    return;
  }

  let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

  // show stored link if already claimed today
  if (state.date === today() && state.link) {
    btn.disabled = true;
    statusEl.textContent = 'Already claimed today';
    out.innerHTML = `<a href="${state.link}" target="_blank">${state.link}</a>`;
    return;
  }

  btn.onclick = () => {
    if (state.date === today()) return;

    const random = allLinks[Math.floor(Math.random() * allLinks.length)];
    out.innerHTML = `<a href="${random}" target="_blank">${random}</a>`;
    state = { date: today(), link: random };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    btn.disabled = true;
    statusEl.textContent = 'Already claimed today';
  };
})();
</script>
</body>
</html>
